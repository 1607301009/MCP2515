C51 COMPILER V9.60.0.0   UART                                                              09/10/2021 02:43:33 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN .\Objects\UART.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE UART.c COMPACT OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listi
                    -ngs\UART.lst) TABS(2) OBJECT(.\Objects\UART.obj)

line level    source

   1          #include <REG52.H>
   2          
   3          #define FOSC   11059200UL        /*单片机使用11.0592M晶体*/
   4          #define BAUD   9600UL            /*波特率定义为9600*/
   5          
   6          bit UART_Busy_Flag = 0;                //串口1发送数据忙标志位
   7          
   8          /*******************************************************************************
   9          * 函数名  : UART_init
  10          * 描述    : UART初始化配置
  11          * 输入    : 无
  12          * 输出    : 无
  13          * 返回值  : 无
  14          * 说明    : 无
  15          *******************************************************************************/
  16          void UART_init(void)        //串口初始化
  17          {
  18   1          EA = 0;                        //暂时关闭中断
  19   1          TMOD &= 0x0F;                //定时器1模式控制在高4位
  20   1          TMOD |= 0x20;                //定时器1工作在模式2，自动重装模式
  21   1          SCON = 0x50;                //串口工作在模式1
  22   1          TH1 = 256 - FOSC / (BAUD * 12 * 16); //计算定时器重装值
  23   1          TL1 = 256 - FOSC / (BAUD * 12 * 16);
  24   1          PCON |= 0x80;                //串口波特率加倍
  25   1          TI = 1;
  26   1          ES = 1;                        //串行中断允许
  27   1          TR1 = 1;                        //启动定时器1
  28   1          REN = 1;                        //允许接收
  29   1          EA = 1;                        //允许中断
  30   1      }
  31          
  32          /*******************************************************************************
  33          * 函数名  : uart
  34          * 描述    : UART中断服务函数
  35          * 输入    : 无
  36          * 输出    : 无
  37          * 返回值  : 无
  38          * 说明    : 无
  39          *******************************************************************************/
  40          void uart(void) interrupt 4         //串口发送中断
  41          {
  42   1      if(RI)    //收到数据
  43   1      {
  44   2      RI = 0;   //清中断请求
  45   2      }
  46   1      else      //发送完一字节数据
  47   1      {
  48   2      TI = 0;
  49   2      UART_Busy_Flag = 0;  //清0正在发送标志
  50   2      }
  51   1      }
  52          
  53          /*******************************************************************************
  54          * 函数名  : UART_send_str
C51 COMPILER V9.60.0.0   UART                                                              09/10/2021 02:43:33 PAGE 2   

  55          * 描述    : UART发送一个字节
  56          * 输入    : d：待发送数据
  57          * 输出    : 无
  58          * 返回值  : 无
  59          * 说明    : 无
  60          *******************************************************************************/
  61          void UART_send_str(unsigned char d)          //发送一个字节的数据，形参d即为待发送数据。
  62          {
  63   1          SBUF = d; //将数据写入到串口缓冲
  64   1          UART_Busy_Flag = 1;     //设置发送标志
  65   1          while (UART_Busy_Flag); //等待发送完毕
  66   1      }
  67          
  68          /*******************************************************************************
  69          * 函数名  : UART_send_buffer
  70          * 描述    : UART发送一个缓冲区数据
  71          * 输入    : *buff：待发送缓冲区首地址,len：待发送数据长度
  72          * 输出    : 无
  73          * 返回值  : 无
  74          * 说明    : 无
  75          *******************************************************************************/
  76          void UART_send_buffer(unsigned char *buffer) {
  77   1          do {
  78   2              UART_send_str(*buffer); //发送一个字符
  79   2          } while (*buffer++ != '\0');
  80   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    100    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----       3
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
